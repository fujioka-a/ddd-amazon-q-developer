# タスク管理アプリケーション - バックエンド

このディレクトリには、DDDアプローチに基づいたタスク管理アプリケーションのバックエンド実装が含まれています。

## アーキテクチャ

バックエンドはオニオンアーキテクチャに基づいて設計されており、以下の層で構成されています：

### 1. ドメイン層 (`domain/`)

ビジネスロジックの中心となる層で、外部の依存関係を持ちません。

- **エンティティ** (`entities/`): ビジネスオブジェクトとその振る舞い
  - `Task`: タスクエンティティ

- **値オブジェクト** (`value_objects/`): 不変の値を表現するオブジェクト
  - `TaskStatus`: タスクのステータス（未着手、進行中、完了）

- **リポジトリインターフェース** (`repositories/`): データアクセスの抽象化
  - `TaskRepository`: タスクの永続化操作を定義するインターフェース

- **ドメインサービス** (`services/`): 複数のエンティティにまたがる操作
  - `TaskService`: タスク関連のドメインロジック

### 2. アプリケーション層 (`application/`)

ユースケースを実装し、ドメイン層のオブジェクトを操作します。

- **ユースケース** (`use_cases/`): アプリケーションの機能
  - `TaskUseCases`: タスクの作成、取得、更新、削除などのユースケース

- **DTO** (`dtos/`): データ転送オブジェクト
  - `TaskDTO`: APIとドメイン層の間でデータを転送するためのオブジェクト

### 3. インフラストラクチャ層 (`infrastructure/`)

外部サービスとの連携を担当します。

- **永続化** (`persistence/`): データベースアクセス
  - `DynamoDBTaskRepository`: DynamoDBを使用したタスクリポジトリの実装

- **認証** (`auth/`): 認証サービス
  - `CognitoAuthService`: Amazon Cognitoを使用した認証サービス

### 4. インターフェース層 (`interfaces/`)

外部とのインターフェースを提供します。

- **API** (`api/`): APIエンドポイント
  - `TaskAPI`: タスク関連のAPIハンドラー

- **ハンドラー** (`handlers/`): AWS Lambda関数のエントリーポイント
  - `lambda_handler.py`: Lambda関数のメインハンドラー

## 実装の特徴

### DDDの原則の適用

- **ドメインモデルの明確な分離**: ビジネスロジックをドメイン層に集中させ、他の関心事から分離
- **ユビキタス言語**: コード内で一貫した用語を使用（タスク、ステータスなど）
- **値オブジェクト**: 不変の値（TaskStatus）を値オブジェクトとして実装
- **エンティティ**: 一意のIDを持つオブジェクト（Task）をエンティティとして実装
- **リポジトリ**: データアクセスを抽象化し、ドメインオブジェクトの永続化を担当

### クリーンアーキテクチャの原則

- **依存性逆転の原則**: 高レベルモジュール（ドメイン層）が低レベルモジュール（インフラストラクチャ層）に依存しない
- **単一責任の原則**: 各クラスが明確な責任を持つ
- **インターフェース分離の原則**: クライアントが使用しないインターフェースに依存しない
- **テスト容易性**: モックを使用した単体テストが容易

### サーバーレスアーキテクチャ

- **AWS Lambda**: イベント駆動型の関数実行
- **API Gateway**: RESTful APIエンドポイント
- **DynamoDB**: スケーラブルなNoSQLデータベース
- **Cognito**: ユーザー認証と認可

## 主要なコンポーネント

### タスクエンティティ (`Task`)

タスク管理の中心となるエンティティで、以下のプロパティを持ちます：

- `task_id`: タスクの一意識別子
- `title`: タスクのタイトル
- `description`: タスクの説明（オプション）
- `status`: タスクのステータス（未着手、進行中、完了）
- `due_date`: タスクの期限（オプション）
- `user_id`: タスクの所有者ID
- `created_at`: 作成日時
- `updated_at`: 更新日時

### タスクステータス (`TaskStatus`)

タスクの状態を表す値オブジェクトで、以下の値を持ちます：

- `NOT_STARTED`: 未着手
- `IN_PROGRESS`: 進行中
- `COMPLETED`: 完了

### タスクリポジトリ (`TaskRepository`)

タスクの永続化操作を定義するインターフェースで、以下のメソッドを提供します：

- `save(task)`: タスクを保存
- `find_by_id(task_id, user_id)`: IDによるタスクの検索
- `find_all_by_user_id(user_id)`: ユーザーIDに基づくすべてのタスクの取得
- `delete(task_id, user_id)`: タスクの削除

### タスクユースケース (`TaskUseCases`)

アプリケーションの機能を実装するクラスで、以下のメソッドを提供します：

- `create_task(task_dto)`: 新しいタスクを作成
- `get_task(task_id, user_id)`: 特定のタスクを取得
- `get_all_tasks(user_id)`: ユーザーのすべてのタスクを取得
- `update_task(task_dto)`: タスクを更新
- `delete_task(task_id, user_id)`: タスクを削除
- `update_task_status(task_id, user_id, status)`: タスクのステータスを更新

## 開発環境のセットアップ

### 前提条件

- Python 3.13
- uv (Python パッケージマネージャー)
- AWS SAM CLI

### インストール

1. 依存関係をインストールします：

```bash
# 基本的な依存関係のインストール
make install

# または開発用の依存関係も含めてインストール
make install-dev
```

### コード品質管理

```bash
# コードフォーマット
make format

# リントチェック
make lint

# テスト実行
make test
```

### ローカル実行

```bash
# SAMを使用してローカルでAPIを実行
make sam-local
```

### デプロイ

```bash
# AWSにデプロイ
make sam-deploy
```

## 依存関係

- Python 3.13
- boto3: AWS SDKライブラリ
- PyJWT: JWTトークン処理ライブラリ
- cryptography: 暗号化ライブラリ
- uvicorn: ASGIサーバー（ローカル開発用）

### 開発用ツール

- pytest: テストフレームワーク
- ruff: リンターとフォーマッター
- mypy: 静的型チェッカー
- moto: AWSサービスのモック
